<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js ie6 oldie" dir="ltr" lang="pt-BR"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" dir="ltr" lang="pt-BR"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" dir="ltr" lang="pt-BR"> <![endif]-->
<!--[if gt IE 8]><!--> <html dir="ltr" lang="pt-BR"> <!--<![endif]-->

<!-- Mirrored from activate-framework.org/documentation/persistence-context/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 27 Feb 2016 17:49:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>

	<!--=== META TAGS ===-->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta charset="UTF-8" />
	<meta name="description" content="Keywords">
	<meta name="author" content="Name">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!--=== LINK TAGS ===-->
	<link rel="shortcut icon" href="../../favicon.ico" />
	<link rel="alternate" type="application/rss+xml" title="Activate Persistence Framework RSS2 Feed" href="../../feed/index.html" />
	<link rel="pingback" href="../../xmlrpc.php" />
	<link rel="apple-touch-icon" href="images/apple-touch-icon.html">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.html">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.html">

	<!--=== TITLE ===-->
	<title> &raquo; Persistence context - Activate Persistence Framework</title>
	
	<!--== GOOGLE FONTS ==-->
	<link href='http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

	<!--=== WP_HEAD() ===-->
	<link rel="alternate" type="application/rss+xml" title="Activate Persistence Framework &raquo; Persistence context Comments Feed" href="feed/index.html" />
<link rel='stylesheet' id='base-style-css'  href='../../wp-content/themes/atom/css/base68b3.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='skeleton-style-css'  href='../../wp-content/themes/atom/css/skeleton68b3.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='layout-style-css'  href='../../wp-content/themes/atom/css/layout68b3.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='main-style-css'  href='../../wp-content/themes/atom/style5152.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='shortcodes-style-css'  href='../../wp-content/themes/atom/wpts/shortcodes/assets/css/shortcodes68b3.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='pretty-style-css'  href='../../wp-content/themes/atom/wpts/shortcodes/assets/prettyphoto/css/prettyPhoto68b3.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='shCore-style-css'  href='../../wp-content/themes/atom/wpts/shortcodes/assets/syntaxhigh/styles/shCoredc98.css?ver=all' type='text/css' media='all' />
<link rel='stylesheet' id='shThemeDefault-css'  href='../../wp-content/themes/atom/wpts/shortcodes/assets/syntaxhigh/styles/shThemeDefaultdc98.css?ver=all' type='text/css' media='all' />
<link rel='stylesheet' id='flex-slider-css-css'  href='../../wp-content/themes/atom/wpts/shortcodes/assets/flexslider/flexslider.css' type='text/css' media='all' />
<link rel='stylesheet' id='uploadify-css-css'  href='../../wp-content/themes/atom/uploadify/uploadify.css' type='text/css' media='all' />
<script type="text/javascript">var THEME_DIR = "../../wp-content/themes/atom/index.html";</script><script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>
<script type='text/javascript' src='http://html5shim.googlecode.com/svn/trunk/html5.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/js/jquery.isotope.min.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/js/init.js'></script>
<script type='text/javascript' src='https://apis.google.com/js/plusone.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/jquery.tweet68b3.js?ver=1'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/jquery.tipTip.minified4e44.js?ver=1.3'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/prettyphoto/js/jquery.prettyPhoto.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/prettyphoto/init.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/syntaxhigh/scripts/shCore.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/syntaxhigh/scripts/shAutoloader.js'></script>
<script type='text/javascript' src='http://maps.googleapis.com/maps/api/js?key=&amp;sensor=false'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/jquery.gmap-1.1.0-min.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/flexslider/jquery.flexslider-min.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/uploadify/swfobject.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/uploadify/jquery.uploadify.v2.1.4.min.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/js/ordernow.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://activate-framework.org/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Documentation' href='../index.html' />
<link rel='next' title='Entity' href='../entity/index.html' />
<link rel='canonical' href='index.html' />
	<link type="text/css" rel="stylesheet" href="../../wp-content/plugins/syntaxhighlighter-plus/syntaxhighlighter/styles/shCore.css"></link>
	<link type="text/css" rel="stylesheet" href="../../wp-content/plugins/syntaxhighlighter-plus/syntaxhighlighter/styles/shThemeDefault.css"></link>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34374169-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body class="page page-id-697 page-child parent-pageid-694 page-template-default">

<div class="container" id="header-wrapper-top">
	<div id="logo-top">
		<a href="../../index.html"><img class="scale-with-grid" src="../../wp-content/uploads/2012/05/activate_logo_site3.png" alt=" " /></a>
	</div><!-- #logo -->
	
	<div id="navigation-toggle"><a href="#">SHOW NAVIGATION</a></div>
				
	<div id="top-menu">
		<ul id="menu-main-menu" class="nav"><li id="menu-item-186" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href="../../index.html">HOME</a></li>
<li id="menu-item-1407" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate/blob/master/activate-docs/get-started.md">GET STARTED</a></li>
<li id="menu-item-1394" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate/blob/v1.5/activate-docs/_index.md">DOCUMENTATION</a></li>
<li id="menu-item-578" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate">SOURCE CODE</a></li>
<li id="menu-item-443" class="menu-item menu-item-type-custom menu-item-object-custom"><a target="_blank" href="https://github.com/fwbrasil/activate/issues">ISSUES</a></li>
<li id="menu-item-291" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="../../blog/index.html">BLOG</a></li>
<li id="menu-item-939" class="menu-item menu-item-type-custom menu-item-object-custom"><a target="_blank" href="http://groups.google.com/group/activate-persistence">GOOGLE GROUP</a></li>
</ul>	</div> <!-- #side-menu -->
</div>

	<div class="container" id="wrapper">
		
		<div class="columns twelve alpha omega" id="main-content">
		
						
			<div class="mega-title mega-single">
				<h1>Persistence context</h1>
			</div>
			
			<div class="post">
				<div class="post-content page-content">
					<p>To use Activate, first you have to define a Persistence Context. It coordinates all the persistence needs, like transactions and the persistence lifecycle of entities.</p>
<p><strong>Important</strong>: The context definition must be declared in a base package of the entities and migrations packages.<br />
Example: com.app.myContext for com.app.model.MyEntity</p>
<p>Context must be a singleton, so it makes sense declare it as &#8220;object&#8221;. The name must be unique.</p>
<p>Examples:</p>
<div class="tabs_framed_container">
<ul class="tabs_framed">
<li><a href="#">PostgreSQL</a></li>
<li><a href="#">Mysql</a></li>
<li><a href="#">Oracle</a></li>
<li><a href="#">H2</a></li>
<li><a href="#">Derby</a></li>
<li><a href="#">HsqlDB</a></li>
<li><a href="#">DB2</a></li>
<li><a href="#">Sql Server</a></li>
<li><a href="#">MongoDB</a></li>
<li><a href="#">Prevayler</a></li>
<li><a href="#">Prevalent</a></li>
<li><a href="#">Transient Memory</a></li>
<li><a href="#">Async MongoDB</a></li>
<li><a href="#">Async PostgreSQL</a></li>
</ul>
<div class="panes">
<div class="pane pane-0">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorage
import net.fwbrasil.activate.storage.relational.idiom.postgresqlDialect

object postgresqlContext extends ActivateContext {
    val storage = new PooledJdbcRelationalStorage {
		val jdbcDriver = "org.postgresql.Driver"
		val user = "USER"
		val password = "PASS"
		val url = "jdbc:postgresql://127.0.0.1/postgres"
		val dialect = postgresqlDialect
	}
}
</pre>
</div>
<div class="pane pane-1">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorage
import net.fwbrasil.activate.storage.relational.idiom.mySqlDialect

object mysqlContext extends ActivateContext {
    val storage = new PooledJdbcRelationalStorage {
		val jdbcDriver = "com.mysql.jdbc.Driver"
		val user = "USER"
		val password = "PASS"
		val url = "jdbc:mysql://127.0.0.1/myDatabase"
		val dialect = mySqlDialect
	}
}
</pre>
</div>
<div class="pane pane-2">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorage
import net.fwbrasil.activate.storage.relational.idiom.oracleDialect

object oracleContext extends ActivateContext {
    val storage = new PooledJdbcRelationalStorage {
		val jdbcDriver = "oracle.jdbc.driver.OracleDriver"
		val user = "USER"
		val password = "PASS"
		val url = "jdbc:oracle:thin:@localhost:1521:oracle"
		val dialect = oracleDialect
	}
}
</pre>
</div>
<div class="pane pane-3">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorage
import net.fwbrasil.activate.storage.relational.idiom.h2Dialect

object h2Context extends ActivateContext {
    val storage = new PooledJdbcRelationalStorage {
		val jdbcDriver = "org.h2.Driver"
		val user = "USER"
		val password = "PASS"
		val url = "jdbc:h2:mem:my_database;DB_CLOSE_DELAY=-1"
		val dialect = h2Dialect
	}
}
</pre>
</div>
<div class="pane pane-4">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorage
import net.fwbrasil.activate.storage.relational.idiom.derbyDialect

object h2Context extends ActivateContext {
    val storage = new PooledJdbcRelationalStorage {
		val jdbcDriver = "org.apache.derby.jdbc.EmbeddedDriver"
		val user = "USER"
		val password = "PASS"
		val url = "jdbc:derby:memory:my_database;create=true"
		val dialect = derbyDialect
	}
}
</pre>
</div>
<div class="pane pane-5">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorage
import net.fwbrasil.activate.storage.relational.idiom.hsqldbDialect

object h2Context extends ActivateContext {
	val storage = new PooledJdbcRelationalStorage {
		val jdbcDriver = "org.hsqldb.jdbcDriver"
		val user = "USER"
		val password = "PASS"
		val url = "jdbc:hsqldb:mem:my_database"
		val dialect = hsqldbDialect
	}
}
</pre>
</div>
<div class="pane pane-6">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorage
import net.fwbrasil.activate.storage.relational.idiom.db2Dialect

object db2Context extends ActivateContext {
	val storage = new PooledJdbcRelationalStorage {
		val jdbcDriver = "com.ibm.db2.jcc.DB2Driver"
		val user = "USER"
		val password = "PASS"
		val url = "jdbc:db2://localhost:50000/MYDB"
		val dialect = db2Dialect
	}
}
</pre>
</div>
<div class="pane pane-7">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorage
import net.fwbrasil.activate.storage.relational.idiom.sqlServerDialect

object sqlServerContext extends ActivateContext {
	val storage = new PooledJdbcRelationalStorage {
		val jdbcDriver = "net.sourceforge.jtds.jdbc.Driver"
		val user = "USER"
		val password = "PASS"
		val url = "jdbc:jtds:sqlserver://localhost:49503/mydb"
		val dialect = sqlServerDialect
	}
}
</pre>
</div>
<div class="pane pane-8">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.mongo.MongoStorage

object mongoContext extends ActivateContext {
    val storage = new MongoStorage {
        val host = "localhost"
        override val port = 27017
        val db = "dbName"
        override val authentication = Option("USER", "PASS")
    }
}
</pre>
</div>
<div class="pane pane-9">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.prevayler.PrevaylerStorage

object prevaylerContext extends ActivateContext {
    val storage = new PrevaylerStorage
}
</pre>
</div>
<div class="pane pane-10">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.prevalent.PrevalentStorage

object prevalentContext extends ActivateContext {
    val storage = new PrevalentStorage("someDirectory")
}
</pre>
</div>
<div class="pane pane-11">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.memory.TransientMemoryStorage

object memoryContext extends ActivateContext {
    val storage = new TransientMemoryStorage
}
</pre>
</div>
<div class="pane pane-12">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.mongo.async.AsyncMongoStorage

object asyncMongoContext extends ActivateContext {
    val storage = new AsyncMongoStorage {
        val host = "localhost"
        override val port = 27017
        val db = "dbName"
        override val authentication = Option("USER", "PASS")
    }
}
</pre>
</div>
<div class="pane pane-13">
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import com.github.mauricio.async.db.Configuration
import com.github.mauricio.async.db.postgresql.pool.PostgreSQLConnectionFactory
import net.fwbrasil.activate.storage.relational.async.AsyncPostgreSQLStorage

object asyncPostgreSQLContext extends ActivateContext {
    val storage = new AsyncPostgreSQLStorage {
        def configuration =
            new Configuration(
                username = "user",
                host = "localhost",
                password = Some("password"),
                database = Some("database_name"))
        lazy val objectFactory = new PostgreSQLConnectionFactory(configuration)
    }
}
</pre>
</div>
</div>
</div>
<p>All storages implements a method called &#8220;<strong>directAccess</strong>&#8221; which provides direct access to the underlying database. Use this method carefully, if you modify the database content, the entities in memory could stay in an inconsistent state.</p>
<p><a name="system_properties"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#system_properties">System properties</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>It&#8217;s possible to define the storage based on system properties. For this context:</p>
<pre class="brush: scala">

import net.fwbrasil.activate.ActivateContext
import net.fwbrasil.activate.storage.StorageFactory

object myContext extends ActivateContext {
    val storage = StorageFactory.fromSystemProperties("myContext")
}
</pre>
<p>These are the system properties:</p>
<div class="tabs_framed_container">
<ul class="tabs_framed">
<li><a href="#">PostgreSQL</a></li>
<li><a href="#">Mysql</a></li>
<li><a href="#">Oracle</a></li>
<li><a href="#">H2</a></li>
<li><a href="#">Derby</a></li>
<li><a href="#">HsqlDB</a></li>
<li><a href="#">DB2</a></li>
<li><a href="#">Sql Server</a></li>
<li><a href="#">MongoDB</a></li>
<li><a href="#">Prevayler</a></li>
<li><a href="#">Prevalent</a></li>
<li><a href="#">Transient Memory</a></li>
<li><a href="#">Async MongoDB</a></li>
<li><a href="#">Async PostgreSQL</a></li>
</ul>
<div class="panes">
<div class="pane pane-0">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorageFactory
activate.storage.myContext.jdbcDriver=org.postgresql.Driver
activate.storage.myContext.user=USER
activate.storage.myContext.password=PASS
activate.storage.myContext.url=jdbc:postgresql://127.0.0.1/postgres
activate.storage.myContext.dialect=postgresqlDialect
</pre>
</div>
<div class="pane pane-1">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorageFactory
activate.storage.myContext.jdbcDriver=com.mysql.jdbc.Driver
activate.storage.myContext.user=USER
activate.storage.myContext.password=PASS
activate.storage.myContext.url=jdbc:mysql://127.0.0.1/myDatabase
activate.storage.myContext.dialect=mySqlDialect
</pre>
</div>
<div class="pane pane-2">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorageFactory
activate.storage.myContext.jdbcDriver=oracle.jdbc.driver.OracleDriver
activate.storage.myContext.user=USER
activate.storage.myContext.password=PASS
activate.storage.myContext.url=jdbc:oracle:thin:@localhost:1521:oracle
activate.storage.myContext.dialect=oracleDialect
</pre>
</div>
<div class="pane pane-3">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorageFactory
activate.storage.myContext.jdbcDriver=org.h2.Driver
activate.storage.myContext.user=USER
activate.storage.myContext.password=PASS
activate.storage.myContext.url=jdbc:h2:mem:my_database;DB_CLOSE_DELAY=-1
activate.storage.myContext.dialect=h2Dialect
</pre>
</div>
<div class="pane pane-4">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorageFactory
activate.storage.myContext.jdbcDriver=org.apache.derby.jdbc.EmbeddedDriver
activate.storage.myContext.user=USER
activate.storage.myContext.password=PASS
activate.storage.myContext.url=jdbc:derby:memory:my_database;create=true
activate.storage.myContext.dialect=derbyDialect
</pre>
</div>
<div class="pane pane-5">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorageFactory
activate.storage.myContext.jdbcDriver=org.hsqldb.jdbcDriver
activate.storage.myContext.user=USER
activate.storage.myContext.password=PASS
activate.storage.myContext.url=jdbc:hsqldb:mem:my_database
activate.storage.myContext.dialect=hsqldbDialect
</pre>
</div>
<div class="pane pane-6">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorageFactory
activate.storage.myContext.jdbcDriver=com.ibm.db2.jcc.DB2Driver
activate.storage.myContext.user=USER
activate.storage.myContext.password=PASS
activate.storage.myContext.url=jdbc:db2://loacalhost:50000/MYDB
activate.storage.myContext.dialect=db2Dialect
</pre>
</div>
<div class="pane pane-7">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.relational.PooledJdbcRelationalStorageFactory
activate.storage.myContext.jdbcDriver=net.sourceforge.jtds.jdbc.Driver
activate.storage.myContext.user=USER
activate.storage.myContext.password=PASS
activate.storage.myContext.url=jdbc:jtds:sqlserver://localhost:49503/mydb
activate.storage.myContext.dialect=sqlServerDialect
</pre>
</div>
<div class="pane pane-8">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.mongo.MongoStorageFactory
activate.storage.myContext.host=localhost
activate.storage.myContext.port=27017
activate.storage.myContext.db=dbName
activate.storage.myContext.user=USER
activate.storage.myContext.password=PASS
</pre>
<p>NOTE: User and password are optional</p></div>
<div class="pane pane-9">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.prevayler.PrevaylerMemoryStorageFactory
activate.storage.myContext.prevalenceDirectory=myPrevalenceDirectory
</pre>
<p>NOTE: The prevalence directory is optional. Default is &#8220;activate&#8221;.</p></div>
<div class="pane pane-10">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.prevalent.PrevalentStorageFactory
activate.storage.myContext.directory=someDirectory
</pre>
</div>
<div class="pane pane-11">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.memory.TransientMemoryStorageFactory
</pre>
</div>
<div class="pane pane-12">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.mongo.async.AsyncMongoStorageFactory
activate.storage.myContext.host=localhost
activate.storage.myContext.port=27017
activate.storage.myContext.db=dbName
activate.storage.myContext.user=USER
activate.storage.myContext.password=PASS
</pre>
<p>NOTE: User and password are optional</p></div>
<div class="pane pane-13">
<pre class="brush: scala">

activate.storage.myContext.factory=net.fwbrasil.activate.storage.relational.async.AsyncPostgreSQLStorageFactory
activate.storage.myContext.host=localhost
activate.storage.myContext.database=dbName
activate.storage.myContext.user=USER
activate.storage.myContext.password=PASS
</pre>
</div>
</div>
</div>
<p><a name="custom_cache_configuration"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#custom_cache_configuration">Custom cache configuration</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>Activate has a cache called LiveCache that uses <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/ref/SoftReference.html">soft references</a> for the entities. They that are cleaned as soon the virtual machine needs memory. See the <a href="../architecture/index.html" title="Architecture">Architecture</a> documentation for more information. This behavior should be sufficient for most of the use cases, but there is a mechanism to customize the caching configuration. </p>
<p>It is possible to modify the LiveCache to use <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/ref/WeakReference.html">weak references</a> for example:</p>
<pre class="brush: scala">

object myContext extends ActivateContext {
    val storage = ...
    override def liveCacheType =
        CacheType.weakReferences
}
</pre>
<p>And create custom caches per entity class:</p>
<pre class="brush: scala">

object myContext extends ActivateContext {
    val storage = ...
    override def liveCacheType =
        CacheType.weakReferences
    override def customCaches =
        List(
            CustomCache[MyEntity](
                cacheType = CacheType.weakReferences,
                limitOption = Some(1000))
}
</pre>
<p>Entities that extend the MyEntity class will be hold in this cache at limit of 1000 instances.</p>
<p>These are the CustomCache parameters and default values:</p>
<pre class="brush: scala">

case class CustomCache[E &lt;: Entity: Manifest](
        cacheType: CacheType,
        transactionalCondition: Boolean = false,
        condition: E => Boolean = (e: E) => true,
        limitOption: Option[Long] = None,
        expiration: Duration = Duration.Inf)
</pre>
<p><strong>cacheType</strong><br />
The type of references to be used by the cache.</p>
<p><strong>transactionalCondition</strong><br />
Indicates if the condition block must run inside a transaction.</p>
<p><strong>condition</strong><br />
A condition that entities must satisfy to be in the cache.</p>
<p><strong>limitOption</strong><br />
Limit of instances to be in the cache</p>
<p><strong>expiration</strong><br />
How long an instance should be maintained by the cache</p>
<p>An interesting use case could be for example to maintain in-memory entities of premium users of an application:</p>
<pre class="brush: scala">

object myContext extends ActivateContext {
    val storage = ...
    override def customCaches =
        List(
            CustomCache[User](
                cacheType = CacheType.hardReferences,
                transactionalCondition = true,
                condition = (u: User) => u.isPremium
                limitOption = Some(1000))
}
	</pre>
<p>The CustomCaches are consistent with new end modified entities by transactions.</p>
<p><a name="context_useful_method_values"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#context_useful_method_values">Context useful methods and values</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p style="padding-left: 30px;">
<strong>df reinitializeContext: Unit</strong><br />
Reinitializes the context, cleaning the LiveCache.
</p>
<p style="padding-left: 30px;">
<strong>def currentTransaction: Transaction</strong><br />
Returns the current transaction.
</p>
<p style="padding-left: 30px;">
<strong>def reloadEntities(ids: Set[String]): Unit</strong><br />
Forces the specified entities to reload from the database.
</p>
<p style="padding-left: 30px;">
<strong>val retryLimit: Int</strong><br />
Indicates the limit number of tentatives to retry a transaction. Default: 3000.
</p>
<p><a name="polyglot_context"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#polyglot_context">polyglot context</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>Activate has support to do polyglot persistence. It is possible to determine the storage that must persist each entity class. For example, an entity from a relational database can have a property that is an entity persisted at a non-relational database.</p>
<p>For synchronized transactions, at commit time, the <a href="http://en.wikipedia.org/wiki/Two-phase_commit_protocol">two phase</a> protocol is used to persist the information in the multiple storages. For non-transactional storages, there is a mechanism that implements a transactional behavior on the application level to do the two phase commit.</p>
<p>For asynchronous transactions, the commit process is executed using a extended transaction model. It is a non-blocking approach for distributed transactions. At commit time, each modification performed during the in memory STM transaction (creates/updates/deletes) is categorized per storage. After, modifications are sent to each storage. If an error occur during the commit process, the already modified storages are rollbacked by the application by sending a set of operations that reverts the performed modifications. For an insert, the rollback operation is a delete. For a delete, an insert. And for an update, an update to the old value. This approach can produce concurrency inconsistencies if there is more than one VM running the persistence context. This is the price to have non-blocking distributed transactions.</p>
<p>To configure the polyglot persistence, override the &#8220;additionalStorages&#8221; method:</p>
<pre class="brush: scala">

object polyglotContext extends ActivateContext {

    val postgre = fromSystemProperties("postgre")
    val mysql = fromSystemProperties("mysql")
    val mongo = fromSystemProperties("mongo")

    val storage = postgre

    override def additionalStorages = Map(
        mongo -> Set(classOf[MyMongoEntity]),
        mysql -> Set(classOf[MyMysqlEntity]))
}
</pre>
<p>By default, Activate will persist all entities in the default storage, in this case postgre. The &#8220;additionalStorages&#8221; method returns a map indicating witch entities must be persisted in other storages. In this case, the &#8220;MyMongoEntity&#8221; will be persisted in mongo and the &#8220;MySqlEntity&#8221; will be persisted in mysql. </p>
<p><strong>IMPORTANT</strong>: A query cannot run using joins with entities that are persisted in different storages.</p>
<p>For implementation details, see the <a href="../architecture/index.html#polyglot">architecture documentation</a>.</p>
<p><a name="multiple_contexts"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#multiple_contexts">Multiple Contexts</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>It&#8217;s possible to have multiple contexts in the same virtual machine. For this scenario, it&#8217;s necessary to override the &#8220;contextEntities&#8221; val in your contexts. Example:</p>
<pre class="brush: scala">

override val contextEntities = Some(List(classOf[MyEntity]))
</pre>
<p>If contextEntities is None (this is the default), Activate assumes that the context accepts all entities. An error will occur if more than one context accepts an entity.</p>
<p>It&#8217;s not possible to have relations between entities from different contexts.</p>
<p><a name="memory_index"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#memory_index">Memory Index</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>The persistence context can have in-memory indexes that provide fast access to entities. The indexes are consistent with new and modified entities by transactions in the same VM. It is possible to enable the optimistic locking with read validation so the cache can be updated for modified entities in other VMs too. For now, the cache can&#8217;t be updated automatically for new entities created in other VMs. This limitation should be resolved on the 1.5 version.</p>
<pre class="brush: scala">

object myContext extends ActivateContext {
    val storage = ...
    val indexPersonByName = memoryIndex[Person].on(_.name)
}
</pre>
<p>To use the index, just call the method &#8220;get&#8221;:</p>
<pre class="brush: scala">

transactional {
    val list: LazyList[Person] = indexPersonByName.get("John")
}
</pre>
<p>The memory index holds references to the keys, the &#8220;name&#8221; in the case, and to the corresponding list of entity ids. The method &#8220;get&#8221; returns a LazyList that loads the entities when needed.</p>
<p>An example with a tuple key:</p>
<pre class="brush: scala">

val indexPersonByNameAndAge =
    memoryIndex[Person].on(person => (person.name, person.age))
val list: LazyList[Person] = indexPersonByNameAndAge.get("John", 30)
</pre>
<p><a name="jdbc"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#jdbc">Jdbc</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>To use jdbc, import the &#8220;<strong>activate-jdbc</strong>&#8221; component in your sbt or maven project.</p>
<p>There are three <a href="http://en.wikipedia.org/wiki/JDBC" target="_blank">jdbc</a> storage implementations inside package <strong>net.fwbrasil.activate.storage.relational</strong>:</p>
<p style="padding-left: 30px;"><strong>PooledJdbcRelationalStorage</strong><br />
Uses a <a href="http://www.mchange.com/projects/c3p0/" title="c3p0" target="_blank">c3p0</a> connection pool to maintain connections.<br />
Properties based factory: PooledJdbcRelationalStorageFactory</p>
<p style="padding-left: 30px;"><strong>DataSourceJdbcRelationalStorage</strong><br />
Uses a container datasource to get connections.<br />
Properties based factory: DataSourceJdbcRelationalStorageFactory</p>
<p style="padding-left: 30px;"><strong>SimpleJdbcRelationalStorage</strong><br />
Open connections on demand. It&#8217;s recommended only for embedded systems.<br />
Properties based factory: SimpleJdbcRelationalStorageFactory</p>
<p>Available dialects inside package <strong>net.fwbrasil.activate.storage.relational.idiom</strong>:</p>
<p style="padding-left: 30px;"><strong>postgresqlDialect</strong></p>
<p style="padding-left: 30px;"><strong>oracleDialect</strong></p>
<p style="padding-left: 30px;"><strong>mySqlDialect</strong></p>
<p style="padding-left: 30px;"><strong>h2Dialect</strong></p>
<p style="padding-left: 30px;"><strong>db2Dialect</strong></p>
<p style="padding-left: 30px;"><strong>derbyDialect</strong></p>
<p style="padding-left: 30px;"><strong>hsqldbDialect</strong></p>
<p>It&#8217;s easy to implement new idioms. <a href="https://github.com/fwbrasil/activate/issues/new" target="_blank">Open an issue</a> if you have a new dialect suggestion.</p>
<p>The &#8220;<strong>directAccess</strong>&#8221; method returns a &#8220;<strong>java.sql.Connection</strong>&#8220;.</p>
<p><a name="mongodb"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#mongodb">MongoDB</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>To use <a href="http://www.mongodb.org/" target="_blank">MongoDB</a>, import the &#8220;<strong>activate-mongo</strong>&#8221; component in your sbt or maven project.</p>
<p>The storage class is <strong>net.fwbrasil.activate.storage.mongo.MongoStorage</strong>.</p>
<p>Mongo is the performance winner between activate supported storages. It has three main restrictions:</p>
<p>1. Only simple queries (no joins) can be performed.<br />
2. It ignores &#8220;add column&#8221;, &#8220;add reference&#8221; and &#8220;remove reference&#8221; migration actions.<br />
3. Activate adds a good level of consistency to the usage with Mongo, but it cannot guarantee that always will be consistent, due the database characteristics.</p>
<p>The &#8220;<strong>directAccess</strong>&#8221; method returns a &#8220;<strong>com.mongodb.DB</strong>&#8220;.</p>
<p><a name="async_mongodb"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#async_mongodb">Async MongoDB</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>To use Async MongoDB, import the &#8220;<strong>activate-mongo-async</strong>&#8221; component in your sbt or maven project.</p>
<p>This storage provides blocking and non-blocking queries and transactions. The <a href="http://reactivemongo.org/">reactivemongo</a> project is used as the underlying database driver.</p>
<p>It is possible to override the &#8220;<strong>val executionContext: ExecutionContext</strong>&#8221; and &#8220;<strong>val defaultTimeout: Int</strong>&#8221; values that are used to perform the blocking operations.</p>
<p>The &#8220;<strong>directAccess</strong>&#8221; method returns a &#8220;<strong>reactivetemongo.api.DefaultDB</strong>&#8220;.</p>
<p><a name="async_postgresql"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#async_postgresql">Async PostgreSQL</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>To use async PostgreSQL, import the &#8220;<strong>activate-jdbc-async</strong>&#8221; component in your sbt or maven project.</p>
<p>This storage provides blocking and non-blocking queries and transactions. The <a href="http://github.com/mauricio/postgresql-async">postgresql-async</a> project is used as the underlying database driver.</p>
<p>It is possible to override the &#8220;<strong>val executionContext: ExecutionContext</strong>&#8221; and &#8220;<strong>val defaultTimeout: Int</strong>&#8221; values that are used to perform the blocking operations.</p>
<p>The &#8220;<strong>directAccess</strong>&#8221; method returns a &#8220;<strong>Future[PostgreSQLConnection]</strong>&#8220;.</p>
<p><a name="prevayler"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#prevayler">Prevayler</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>To use Prevayler, import the &#8220;<strong>activate-prevayler</strong>&#8221; component in your sbt or maven project.</p>
<p><a href="http://prevayler.org/" target="_blank">Prevayler</a> uses the prevalence paradigm, maintaining all the data in memory, so your data must fit in memory.</p>
<p>The storage class is <strong>net.fwbrasil.activate.storage.prevayler.PrevaylerStorage</strong>.</p>
<p>There are three constructors:</p>
<p style="padding-left: 30px;">
<strong>new PrevaylerStorage()</strong><br />
Creates prevayler using the directory &#8220;activate&#8221;.
</p>
<p style="padding-left: 30px;">
<strong>new PrevaylerStorage(prevalenceDirectory: String)</strong><br />
Creates prevayler using the prevalenceDirectory.
</p>
<p style="padding-left: 30px;">
<strong>new PrevaylerStorage(factory: PrevaylerFactory)</strong><br />
Creates prevayler using the factory configurations.
</p>
<p>The &#8220;pure&#8221; prevayler synchronizes the transactions, running only one per time. But Activate can run multiple transactions in parallel and just at the end of the commit time, it uses prevayler which synchronizes the persistence.</p>
<p>For now, Activate don&#8217;t maintain indexes in the prevalent system, so queries can be slow with a big amount of data.</p>
<p>This storage ignores all migration actions except the custom ones.</p>
<p>The &#8220;<strong>directAccess</strong>&#8221; method returns a &#8220;<strong>org.prevayler.Prevayler</strong>&#8220;.</p>
<p><a name="prevalent"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#prevalent">Prevalent</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>To use the PrevalentStorage, import the &#8220;<strong>activate-prevalent</strong>&#8221; component in your sbt or maven project.</p>
<p>This is a custom implementation using the same prevalent paradigm of Prevayler. It has high performance, since uses memory mapped files.</p>
<p>The storage class is <strong>net.fwbrasil.activate.storage.prevalent.PrevalentStorage</strong>.</p>
<p>There is a constructor with default parameters:</p>
<p style="padding-left: 30px;">
class PrevalentStorage(<br />
    directory: String,<br />
    serializer: Serializer = javaSerializer,<br />
    fileSize: Int = 10 * 1000 * 1000,<br />
    bufferPoolSize: Int = Runtime.getRuntime.availableProcessors)
</p>
<p><strong>directory</strong><br />
The directory used to maintain the persistence files.</p>
<p><strong>serializer</strong><br />
The serializer to do snapshots. The transaction serialization is made by the prevalentTransactionSerializer direct to memory.</p>
<p><strong>fileSize</strong><br />
Max size of the transaction log files.</p>
<p><strong>bufferPoolSize</strong><br />
Number of memory buffers to reuse.</p>
<p>This storage ignores all migration actions except the custom ones.</p>
<p>The &#8220;<strong>directAccess</strong>&#8221; method returns a &#8220;<strong>net.fwbrasil.activate.storage.prevalent.PrevalentStorageSystem</strong>&#8220;.</p>
<p><a name="transient_memory"/></p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3><a href="#transient_memory">Transient Memory</a></h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>The transient memory storage is in the &#8220;<strong>activate-core</strong>&#8221; component.</p>
<p>The storage class is <strong>net.fwbrasil.activate.storage.memory.TransientMemoryStorage</strong>.</p>
<p>Transient Memory is designed to be used only to run tests.<br />
It fulfills all the persistence needs, including queries and transactions, but doesn&#8217;t persist the data.</p>
<p>The &#8220;<strong>directAccess</strong>&#8221; method returns a &#8220;<strong>net.fwbrasil.activate.storage.memory.TransientMemoryStorageSet</strong>&#8220;.</p>

<div class="one_half" ></div>
<div class="one_half last " ><p style="text-align: right;"><a href="../entity/index.html" title="Entity">(next) Entity ></a></p></div><div class="clearboth"></div>
				</div>
			</div> <!-- .post -->
						
						
			<!-- START of PAGINATION -->
    		<div class="pagination"><div class='newer-posts'>&nbsp;</div><div class='older-posts'>&nbsp;</div><div class='clearfix'></div></div>
    		<!-- END of PAGINATION -->

		</div> <!-- #main-content -->
		
		 
<div class="columns four alpha" id="side-nav">
	<div id="header-wrapper-side">
<div id="logo">
	<a href="../../index.html"><img class="scale-with-grid" src="../../wp-content/uploads/2012/05/activate_logo_site3.png" alt=" " /></a>
</div><!-- #logo -->

<div id="side-menu">
	<ul id="menu-main-menu-1" class="nav"><li id="menu-item-186" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href="../../index.html">HOME</a></li>
<li id="menu-item-1407" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate/blob/master/activate-docs/get-started.md">GET STARTED</a></li>
<li id="menu-item-1394" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate/blob/v1.5/activate-docs/_index.md">DOCUMENTATION</a></li>
<li id="menu-item-578" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate">SOURCE CODE</a></li>
<li id="menu-item-443" class="menu-item menu-item-type-custom menu-item-object-custom"><a target="_blank" href="https://github.com/fwbrasil/activate/issues">ISSUES</a></li>
<li id="menu-item-291" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="../../blog/index.html">BLOG</a></li>
<li id="menu-item-939" class="menu-item menu-item-type-custom menu-item-object-custom"><a target="_blank" href="http://groups.google.com/group/activate-persistence">GOOGLE GROUP</a></li>
</ul></div> <!-- #side-menu -->

	</div> <!-- #header-wrapper -->
	
	<div id="widgets">
<div id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" action="http://activate-framework.org/" >
	<div><label class="screen-reader-text" for="s">Search for:</label>
	<input type="text" value="" name="s" id="s" />
	<input type="submit" id="searchsubmit" value="Search" />
	</div>
	</form></div>		<div id="recent-posts-2" class="widget widget_recent_entries">		<h3 class="widgettitle"><span class="title">Recent Posts</span></h3>		<ul>
				<li><a href="../../activate-1-6/index.html" title="Activate 1.6">Activate 1.6</a></li>
				<li><a href="../../activate-1-5-is-out/index.html" title="Activate 1.5 is out!">Activate 1.5 is out!</a></li>
				<li><a href="../../activate-1-4-1/index.html" title="Activate 1.4.1">Activate 1.4.1</a></li>
				<li><a href="../../activate-1-3-reactive-persistence/index.html" title="Activate 1.3 &#8211; Reactive Persistence">Activate 1.3 &#8211; Reactive Persistence</a></li>
				<li><a href="../../activate-1-2/index.html" title="Activate 1.2 &#8211; Polyglot Persistence">Activate 1.2 &#8211; Polyglot Persistence</a></li>
				</ul>
		</div><div id="text-3" class="widget widget_text">			<div class="textwidget"></div>
		</div>	</div> <!-- #widgets -->
	
</div> <!-- #side-nav --> 
		
	</div><!-- #wrapper -->

	<!--div class="container" id="footer">
		<div id="footer-line-1" class="footer-line">
			<span class="line-content">
				<font color=white>Activate is released under LGPL license.</font>			</span>
		</div>
	</div-->
	
	<script type="text/javascript">resizeSidenav();</script>

<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/jquery.tools.tabs.min54f4.js?ver=1.2.5'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/tabs-init68b3.js?ver=1'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/pin-init68b3.js?ver=1'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/tweet-api68b3.js?ver=1'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/tooltip-init68b3.js?ver=1'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/syntaxhigh/scripts/shInit68b3.js?ver=1'></script>

<!-- SyntaxHighlighter Stuff -->
<script type="text/javascript" src="../../wp-content/plugins/syntaxhighlighter-plus/syntaxhighlighter/src/shCore.js"></script>
<script type="text/javascript">
	SyntaxHighlighter.all();
</script>

	</body>

<!-- Mirrored from activate-framework.org/documentation/persistence-context/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 27 Feb 2016 17:49:41 GMT -->
</html>