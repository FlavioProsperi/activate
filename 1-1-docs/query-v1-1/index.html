<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js ie6 oldie" dir="ltr" lang="pt-BR"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" dir="ltr" lang="pt-BR"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" dir="ltr" lang="pt-BR"> <![endif]-->
<!--[if gt IE 8]><!--> <html dir="ltr" lang="pt-BR"> <!--<![endif]-->

<!-- Mirrored from activate-framework.org/1-1-docs/query-v1-1/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 27 Feb 2016 17:51:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>

	<!--=== META TAGS ===-->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta charset="UTF-8" />
	<meta name="description" content="Keywords">
	<meta name="author" content="Name">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!--=== LINK TAGS ===-->
	<link rel="shortcut icon" href="../../favicon.ico" />
	<link rel="alternate" type="application/rss+xml" title="Activate Persistence Framework RSS2 Feed" href="../../feed/index.html" />
	<link rel="pingback" href="../../xmlrpc.php" />
	<link rel="apple-touch-icon" href="images/apple-touch-icon.html">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.html">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.html">

	<!--=== TITLE ===-->
	<title> &raquo; Query (v1.1) - Activate Persistence Framework</title>
	
	<!--== GOOGLE FONTS ==-->
	<link href='http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

	<!--=== WP_HEAD() ===-->
	<link rel="alternate" type="application/rss+xml" title="Activate Persistence Framework &raquo; Query (v1.1) Comments Feed" href="feed/index.html" />
<link rel='stylesheet' id='base-style-css'  href='../../wp-content/themes/atom/css/base68b3.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='skeleton-style-css'  href='../../wp-content/themes/atom/css/skeleton68b3.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='layout-style-css'  href='../../wp-content/themes/atom/css/layout68b3.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='main-style-css'  href='../../wp-content/themes/atom/style5152.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='shortcodes-style-css'  href='../../wp-content/themes/atom/wpts/shortcodes/assets/css/shortcodes68b3.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='pretty-style-css'  href='../../wp-content/themes/atom/wpts/shortcodes/assets/prettyphoto/css/prettyPhoto68b3.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='shCore-style-css'  href='../../wp-content/themes/atom/wpts/shortcodes/assets/syntaxhigh/styles/shCoredc98.css?ver=all' type='text/css' media='all' />
<link rel='stylesheet' id='shThemeDefault-css'  href='../../wp-content/themes/atom/wpts/shortcodes/assets/syntaxhigh/styles/shThemeDefaultdc98.css?ver=all' type='text/css' media='all' />
<link rel='stylesheet' id='flex-slider-css-css'  href='../../wp-content/themes/atom/wpts/shortcodes/assets/flexslider/flexslider.css' type='text/css' media='all' />
<link rel='stylesheet' id='uploadify-css-css'  href='../../wp-content/themes/atom/uploadify/uploadify.css' type='text/css' media='all' />
<script type="text/javascript">var THEME_DIR = "../../wp-content/themes/atom/index.html";</script><script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>
<script type='text/javascript' src='http://html5shim.googlecode.com/svn/trunk/html5.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/js/jquery.isotope.min.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/js/init.js'></script>
<script type='text/javascript' src='https://apis.google.com/js/plusone.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/jquery.tweet68b3.js?ver=1'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/jquery.tipTip.minified4e44.js?ver=1.3'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/prettyphoto/js/jquery.prettyPhoto.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/prettyphoto/init.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/syntaxhigh/scripts/shCore.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/syntaxhigh/scripts/shAutoloader.js'></script>
<script type='text/javascript' src='http://maps.googleapis.com/maps/api/js?key=&amp;sensor=false'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/jquery.gmap-1.1.0-min.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/flexslider/jquery.flexslider-min.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/uploadify/swfobject.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/uploadify/jquery.uploadify.v2.1.4.min.js'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/js/ordernow.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://activate-framework.org/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Play Framework (v1.1)' href='../play-framework-v1-1/index.html' />
<link rel='next' title='Transaction (v1.1)' href='../transaction-v1-1/index.html' />
<link rel='canonical' href='index.html' />
	<link type="text/css" rel="stylesheet" href="../../wp-content/plugins/syntaxhighlighter-plus/syntaxhighlighter/styles/shCore.css"></link>
	<link type="text/css" rel="stylesheet" href="../../wp-content/plugins/syntaxhighlighter-plus/syntaxhighlighter/styles/shThemeDefault.css"></link>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34374169-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body class="page page-id-1019 page-child parent-pageid-1000 page-template-default">

<div class="container" id="header-wrapper-top">
	<div id="logo-top">
		<a href="../../index.html"><img class="scale-with-grid" src="../../wp-content/uploads/2012/05/activate_logo_site3.png" alt=" " /></a>
	</div><!-- #logo -->
	
	<div id="navigation-toggle"><a href="#">SHOW NAVIGATION</a></div>
				
	<div id="top-menu">
		<ul id="menu-main-menu" class="nav"><li id="menu-item-186" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href="../../index.html">HOME</a></li>
<li id="menu-item-1407" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate/blob/master/activate-docs/get-started.md">GET STARTED</a></li>
<li id="menu-item-1394" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate/blob/v1.5/activate-docs/_index.md">DOCUMENTATION</a></li>
<li id="menu-item-578" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate">SOURCE CODE</a></li>
<li id="menu-item-443" class="menu-item menu-item-type-custom menu-item-object-custom"><a target="_blank" href="https://github.com/fwbrasil/activate/issues">ISSUES</a></li>
<li id="menu-item-291" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="../../blog/index.html">BLOG</a></li>
<li id="menu-item-939" class="menu-item menu-item-type-custom menu-item-object-custom"><a target="_blank" href="http://groups.google.com/group/activate-persistence">GOOGLE GROUP</a></li>
</ul>	</div> <!-- #side-menu -->
</div>

	<div class="container" id="wrapper">
		
		<div class="columns twelve alpha omega" id="main-content">
		
						
			<div class="mega-title mega-single">
				<h1>Query (v1.1)</h1>
			</div>
			
			<div class="post">
				<div class="post-content page-content">
					<p>Activate queries are consistent, even with entities created in the current transaction, so a new entity can be return in a query. This is achieved by the LiveCache, which implements in memory the behavior of a database.</p>
<p><strong>Important</strong>:<br />
- Remember to use queries inside transactions.<br />
- Use only attributes accessors inside a query. If you use a method that isn&#8217;t an accessor, Activate can produce a wrong result.</p>
<p>There are some forms of query. Examples:</p>
<pre class="brush: scala">

trait Person extends Entity {
	var name: String
}
class NaturalPerson(var name: String, var motherName: String) extends Person
class LegalPerson(var name: String, var director: NaturalPerson) extends Person
</pre>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3>byId</h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>If you have the entity id, this method is the best way to recover the instance. It has better performance. If the entity is already in memory, Activate can avoid a database trip.</p>
<pre class="brush: scala">

byId[Person](personId)
</pre>
<p>The method return is an Option[Person].</p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3>all</h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>Get all persons:</p>
<pre class="brush: scala">

all[Person]
</pre>
<p>Note that the queries can be made about abstract entities (trait and abstract class).</p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3>select where</h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>Get all natural persons with the name &#8220;John&#8221; and mother name &#8220;Mary&#8221;.</p>
<pre class="brush: scala">

select[NaturalPerson] where(_.name :== "John", _.motherName :== "Mary")
</pre>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3>operators</h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>Activate query operators are preceded by a &#8220;:&#8221;.</p>
<p>The available operators are <strong>:||</strong>, <strong>:&#038;&</strong>, <strong>:==</strong>, <strong>:<</strong>, <strong>:></strong>, <strong>:<=</strong>, <strong>:>=</strong>, <strong>isNull</strong> and <strong>isNotNull</strong>.</p>
<p>You have to use parenthesis to Scala recognize the implicit conversions to Query. Example:</p>
<p>Get all natural persons with the name &#8220;John&#8221; or mother name &#8220;Mary&#8221;.</p>
<pre class="brush: scala">

select[NaturalPerson] where(person => (person.name :== "John") :|| (person.motherName :== "Mary"))
</pre>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3>match operators</h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>Activate supports queries that matches strings by using the operators <strong>like</strong> and <strong>regexp</strong>.</p>
<p>Natural persons that the name start with &#8220;John&#8221;:</p>
<pre class="brush: scala">

select[NaturalPerson] where(_.name like "John*")
</pre>
<p>Use &#8220;*&#8221; to indicate any sequence of characters and &#8220;?&#8221; to indicate one any character.</p>
<p>Natural persons with numbers on name:</p>
<pre class="brush: scala">

select[NaturalPerson] where(_.name regexp "^.*[0-9].*$")
</pre>
<p>Activate relies on the storage regex engine, so it&#8217;s possible that the query result varies according the current storage. For memory and prevayler storages, java regex is used.</p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3>complete query form</h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>The &#8220;all&#8221; and &#8220;select where&#8221; queries are a simplified form of the complete query:</p>
<pre class="brush: scala">

query {
	(person: Person) => where(person.name :== "John") select (person)
}
</pre>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3>joins and nested properties</h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>Queries using more than one entity or nested properties:</p>
<pre class="brush: scala">

query {
	(company: LegalPerson, director: NaturalPerson) => where(company.director :== director) select (company, director)
}
query {
	(company: LegalPerson) => where(company.director.name :== "John2") select (company)
}
</pre>
<p>NOTE: Queries involving more than one entity or nested properties are not supported by MongoStorage.</p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3>ordered query</h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>The complete query form supports the order by clause:</p>
<pre class="brush: scala">

query {
	(entity: MyEntity) =>
		where(entity.attribute like "A*") select (entity) orderBy (entity.attribute)
}
</pre>
<p>If the entity attribute doesn&#8217;t support ordering, a compile error with be thrown. It&#8217;s possible have multiple order by criterias and/or define directions:</p>
<pre class="brush: scala">

query {
	(entity: MyEntity) =>
		where(entity.attribute1 like "A*") select (entity) orderBy (entity.attribute1 asc, entity.attribute2 desc)
}
</pre>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3>paginated query</h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>Paginated query example:</p>
<pre class="brush: scala">

paginatedQuery {
	(entity: MyEntity) =>
		where(entity.attribute like "A*") select (entity) orderBy (entity.attribute)
}.navigator(100)
</pre>
<p>Note that the query must be ordered to be paginated. It returns a Pagination instance. The &#8220;navigator&#8221; method call produces a navigable pagination interface (PaginationNavigator) using the parameter as the page size.</p>
<p>Methods and values of <strong>PaginationNavigator</strong>:</p>
<p style="padding-left: 30px;">
<strong>val numberOfResults: Int</strong><br />
Total number of lines returned by the query.
</p>
<p style="padding-left: 30px;">
<strong>val numberOfPages: Int</strong><br />
Number of pages determined by the page size.
</p>
<p style="padding-left: 30px;">
<strong>def hasNext: Boolean</strong><br />
Indicates if the navigator has a next page.
</p>
<p style="padding-left: 30px;">
<strong>def next: List[S]</strong><br />
Go to next page and return it.
</p>
<p style="padding-left: 30px;">
<strong>def page(number: Int): List[S]</strong><br />
Go to the specified page and return it.
</p>
<p style="padding-left: 30px;">
<strong>def currentPage: List[S]</strong><br />
Return the current page elements.
</p>
<p style="padding-left: 30px;">
<strong>def firstPage: List[S]</strong><br />
Go to the first page and return it.
</p>
<p style="padding-left: 30px;">
<strong>def lastPage: List[S]</strong><br />
Go to the last page and return it.
</p>
<p>NOTE: The PaginationNavigator implements scala.collection.Iterator.</p>
<div class="section-wrapper">
<div class="section-title section-title-default">
<h3>query parse cache</h3>
</div>
<div class="clearfix"></div>
</p></div>
<p>For the complete query form, Activate maintains a parse cache. With this functionality if a query is already parsed before, it is bounded to the current parameters, avoiding to parse again.</p>
<p>This cache doesn&#8217;t works with &#8220;all&#8221; and &#8220;select where&#8221;. If you have a query that will run too many times, prefer to use the complete query form.</p>

<div class="one_half" ><a href="../../documentation/validation/index.html" title="Validation">< Validation (previous)</a></div>
<div class="one_half last " ><p style="text-align: right;"><a href="../../documentation/mass-statement/index.html" title="Mass statement">(next) Mass statement ></a></p></div><div class="clearboth"></div>
				</div>
			</div> <!-- .post -->
						
						
			<!-- START of PAGINATION -->
    		<div class="pagination"><div class='newer-posts'>&nbsp;</div><div class='older-posts'>&nbsp;</div><div class='clearfix'></div></div>
    		<!-- END of PAGINATION -->

		</div> <!-- #main-content -->
		
		 
<div class="columns four alpha" id="side-nav">
	<div id="header-wrapper-side">
<div id="logo">
	<a href="../../index.html"><img class="scale-with-grid" src="../../wp-content/uploads/2012/05/activate_logo_site3.png" alt=" " /></a>
</div><!-- #logo -->

<div id="side-menu">
	<ul id="menu-main-menu-1" class="nav"><li id="menu-item-186" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href="../../index.html">HOME</a></li>
<li id="menu-item-1407" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate/blob/master/activate-docs/get-started.md">GET STARTED</a></li>
<li id="menu-item-1394" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate/blob/v1.5/activate-docs/_index.md">DOCUMENTATION</a></li>
<li id="menu-item-578" class="menu-item menu-item-type-custom menu-item-object-custom"><a href="https://github.com/fwbrasil/activate">SOURCE CODE</a></li>
<li id="menu-item-443" class="menu-item menu-item-type-custom menu-item-object-custom"><a target="_blank" href="https://github.com/fwbrasil/activate/issues">ISSUES</a></li>
<li id="menu-item-291" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="../../blog/index.html">BLOG</a></li>
<li id="menu-item-939" class="menu-item menu-item-type-custom menu-item-object-custom"><a target="_blank" href="http://groups.google.com/group/activate-persistence">GOOGLE GROUP</a></li>
</ul></div> <!-- #side-menu -->

	</div> <!-- #header-wrapper -->
	
	<div id="widgets">
<div id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" action="http://activate-framework.org/" >
	<div><label class="screen-reader-text" for="s">Search for:</label>
	<input type="text" value="" name="s" id="s" />
	<input type="submit" id="searchsubmit" value="Search" />
	</div>
	</form></div>		<div id="recent-posts-2" class="widget widget_recent_entries">		<h3 class="widgettitle"><span class="title">Recent Posts</span></h3>		<ul>
				<li><a href="../../activate-1-6/index.html" title="Activate 1.6">Activate 1.6</a></li>
				<li><a href="../../activate-1-5-is-out/index.html" title="Activate 1.5 is out!">Activate 1.5 is out!</a></li>
				<li><a href="../../activate-1-4-1/index.html" title="Activate 1.4.1">Activate 1.4.1</a></li>
				<li><a href="../../activate-1-3-reactive-persistence/index.html" title="Activate 1.3 &#8211; Reactive Persistence">Activate 1.3 &#8211; Reactive Persistence</a></li>
				<li><a href="../../activate-1-2/index.html" title="Activate 1.2 &#8211; Polyglot Persistence">Activate 1.2 &#8211; Polyglot Persistence</a></li>
				</ul>
		</div><div id="text-3" class="widget widget_text">			<div class="textwidget"></div>
		</div>	</div> <!-- #widgets -->
	
</div> <!-- #side-nav --> 
		
	</div><!-- #wrapper -->

	<!--div class="container" id="footer">
		<div id="footer-line-1" class="footer-line">
			<span class="line-content">
				<font color=white>Activate is released under LGPL license.</font>			</span>
		</div>
	</div-->
	
	<script type="text/javascript">resizeSidenav();</script>

<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/jquery.tools.tabs.min54f4.js?ver=1.2.5'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/tabs-init68b3.js?ver=1'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/pin-init68b3.js?ver=1'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/tweet-api68b3.js?ver=1'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/js/tooltip-init68b3.js?ver=1'></script>
<script type='text/javascript' src='../../wp-content/themes/atom/wpts/shortcodes/assets/syntaxhigh/scripts/shInit68b3.js?ver=1'></script>

<!-- SyntaxHighlighter Stuff -->
<script type="text/javascript" src="../../wp-content/plugins/syntaxhighlighter-plus/syntaxhighlighter/src/shCore.js"></script>
<script type="text/javascript">
	SyntaxHighlighter.all();
</script>

	</body>

<!-- Mirrored from activate-framework.org/1-1-docs/query-v1-1/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 27 Feb 2016 17:51:13 GMT -->
</html>